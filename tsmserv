---
- name: Verify if NetBackup Client is installed
  hosts: all
  gather_facts: false
  vars:
    netbackup_packages:
      - VRTSpbx
      - VRTSnbjava
      - VRTSnbjre
      - VRTSpddeu
      - VRTSpddei
      - VRTSpostgresql
  tasks:
    - name: Check if NetBackup client RPMs are installed on Linux
      shell: rpm -qa | grep "{{ item }}"
      loop: "{{ netbackup_packages }}"
      register: netbackup_check
      ignore_errors: true
      changed_when: false

    - name: Fail if NetBackup client is already installed
      fail:
        msg: "NetBackup client is already installed on this machine."
      when: netbackup_check.results | selectattr('stdout', '!=', '') | list | length > 0

