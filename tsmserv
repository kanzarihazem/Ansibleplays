---
- name: Verify if NetBackup Client is installed
  hosts: all
  gather_facts: false
  vars:ctattr('stdout', '!=', '') | list | length > 0

---
- name: Verify if NetBackup Client is installed on Windows
  hosts: all
  gather_facts: false

  tasks:
    - name: Check if NetBackup client is installed on Windows
      win_reg_stat:
        path: 'HKLM:\SOFTWARE\Veritas\NetBackup\CurrentVersion'
      register: netbackup_check_windows

    - name: Fail if NetBackup client is already installed on Windows
      fail:
        msg: "NetBackup client is already installed on this Windows machine."
      when: netbackup_check_windows.exists
